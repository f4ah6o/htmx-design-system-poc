<div id="task-panel" class="space-y-4">
    {% if flash %}
        {% set flash_class = {
            'success': 'bg-emerald-50 text-emerald-700 border-emerald-200',
            'info': 'bg-blue-50 text-blue-700 border-blue-200',
            'error': 'bg-red-50 text-red-700 border-red-200'
        }.get(flash.level, 'bg-slate-50 text-slate-700 border-slate-200') %}
        <div class="rounded-2xl border px-4 py-3 text-sm font-medium {{ flash_class }}">
            {{ flash.message }}
        </div>
    {% endif %}

    <div class="space-y-3">
        {% for task in tasks %}
            {% set meta = status_meta.get(task.status, status_meta['planning']) %}
            <div class="rounded-2xl border border-slate-200 bg-white p-4 shadow-sm">
                <div class="flex items-start justify-between gap-4">
                    <div class="space-y-2">
                        <div class="flex items-center gap-3 flex-wrap">
                            <p class="text-lg font-semibold text-gray-900">{{ task.title }}</p>
                            <span class="inline-flex items-center rounded-full px-3 py-1 text-xs font-semibold {{ meta.badge_class }}">
                                {{ meta.label }}
                            </span>
                        </div>
                        <p class="text-sm text-gray-600">{{ task.summary }}</p>
                        <p class="text-xs text-gray-400">Owner: {{ task.owner }}</p>
                    </div>
                    <div class="flex flex-col gap-2">
                        <button
                            class="px-3 py-2 rounded-lg border border-gray-200 text-sm text-gray-700 hover:border-blue-400"
                            hx-get="/api/use-cases/tasks/{{ task.id }}/detail"
                            hx-target="#use-case-modal-body"
                            hx-swap="innerHTML"
                            hx-indicator="#use-case-modal-indicator"
                            @click="$dispatch('open-modal', { id: 'use-case-modal' })"
                            type="button"
                        >
                            詳細を見る
                        </button>
                        <button
                            class="px-3 py-2 rounded-lg border border-gray-200 text-sm text-red-600 hover:border-red-400"
                            hx-delete="/api/use-cases/tasks/{{ task.id }}"
                            hx-target="#task-panel"
                            hx-swap="outerHTML"
                            hx-indicator="#task-panel-indicator"
                            hx-confirm="このタスクを削除しますか？"
                            type="button"
                        >
                            削除
                        </button>
                    </div>
                </div>
            </div>
        {% else %}
            <p class="text-sm text-gray-500">タスクがありません。左のフォームから追加してください。</p>
        {% endfor %}
    </div>
</div>
